2.40 Напиши программу, которая читает из потока стандартного ввода числа типа long, пока не возникает ситуация "конец файла"; после этого печатает те из них, которые встретились в пользовательском вводе ровно три раза. Числа должны быть напечатаны в том порядке, в котором встретились в пользовательском вводе в первый раз.


#include <stdio.h>
#include <stdlib.h>

struct num_list {
    long data;
    int count;
    struct num_list *next;
};

struct num_list *is_num_list(long n, struct num_list *ptr)
{
    while (ptr) {
        if (ptr->data == n) {
            return ptr;
        }
        ptr = ptr->next;
    }
    return NULL;
}

struct num_list *add_num_list(long n, struct num_list *last)
{
    if (!last) {
        last = malloc(sizeof(struct num_list)); 
    } else {
        last->next = malloc(sizeof(struct num_list)); 
        last = last->next;
    }
    last->data = n;
    last->count = 1;
    last->next = NULL;
    return last;
}

void show_num_list(struct num_list *ptr)
{
    int print_check = 0;
    while (ptr) {
        if(ptr->count == 3) {
            printf("[%ld]%s", ptr->data, " ");         
            print_check++;
        }
        ptr = ptr->next;
    }
    if(print_check) { 
        printf("\n");         
    }
}

void clearup(struct num_list *ptr)
{
    struct num_list *tmp;
    while(ptr) {
        tmp = ptr;
        ptr = ptr->next;
        free(tmp);
    }
}

int main()
{
    struct num_list *first, *ptr, *last;
    first = last = ptr = NULL;
    long res = 0;
    int i;
    while((i = getchar()) != EOF) {
        if(i >= '0' && i <= '9') {
            res = res * 10 + i - '0';
        } else {
            if (first && (ptr = is_num_list(res, first))) {
                ptr->count++;
            } else {
                last = add_num_list(res, last);
                if (!first) {
                    first = last;
                }
            }
            res = 0;
        }
    }
    show_num_list(first);
    clearup(first);
    return 0;
}

